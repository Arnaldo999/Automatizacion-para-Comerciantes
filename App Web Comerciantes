<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üè™ POS - Almac√©n</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-green: #00ff88;
            --dark-bg: #0a0e1a;
            --card-bg: #141824;
            --accent-blue: #00d4ff;
            --accent-purple: #b84fff;
            --warning-red: #ff3366;
            --success-gold: #ffc700;
            --text-dim: #6b7280;
            --text-light: #e5e7eb;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a1f35 100%);
            color: var(--text-light);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Efecto de estrellas en el fondo */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent);
            background-size: 200% 200%;
            animation: twinkle 8s ease-in-out infinite;
            opacity: 0.3;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* ============================================
           PANTALLA: MEN√ö PRINCIPAL
        ============================================ */
        .screen {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-top: 20px;
        }

        .user-info {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(184, 79, 255, 0.1) 100%);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .user-name {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-id {
            font-size: 1rem;
            color: var(--text-dim);
        }

        .main-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .btn-main {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-purple) 100%);
            border: none;
            border-radius: 20px;
            padding: 30px;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
            font-family: 'Rajdhani', sans-serif;
        }

        .btn-main::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn-main:active::before {
            width: 300px;
            height: 300px;
        }

        .btn-main:active {
            transform: scale(0.95);
        }

        .btn-main.ventas {
            background: linear-gradient(135deg, var(--neon-green) 0%, var(--accent-blue) 100%);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }

        .btn-main.gastos {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--warning-red) 100%);
            box-shadow: 0 10px 30px rgba(184, 79, 255, 0.3);
        }

        .btn-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            display: block;
        }

        /* ============================================
           PANTALLA: NUEVA VENTA
        ============================================ */
        .top-bar {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px 0;
        }

        .btn-back {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 10px 20px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Rajdhani', sans-serif;
        }

        .btn-back:active {
            transform: scale(0.95);
            background: rgba(255, 255, 255, 0.2);
        }

        .display-container {
            background: linear-gradient(135deg, var(--card-bg) 0%, #1f2437 100%);
            border: 2px solid var(--neon-green);
            border-radius: 24px;
            padding: 30px 20px;
            margin-bottom: 30px;
            text-align: center;
            box-shadow: 
                0 0 30px rgba(0, 255, 136, 0.2),
                inset 0 0 30px rgba(0, 255, 136, 0.05);
            position: relative;
            overflow: hidden;
        }

        .display-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(0, 255, 136, 0.1) 50%,
                transparent 70%
            );
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .display-label {
            font-size: 1rem;
            color: var(--text-dim);
            margin-bottom: 5px;
            font-weight: 600;
            letter-spacing: 2px;
        }

        .display-store {
            font-size: 1.2rem;
            color: var(--accent-blue);
            margin-bottom: 15px;
            font-weight: 700;
        }

        .display-total-label {
            font-size: 1.2rem;
            color: var(--neon-green);
            margin-bottom: 10px;
            font-weight: 700;
            letter-spacing: 3px;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .display-total {
            font-family: 'Orbitron', monospace;
            font-size: 4rem;
            font-weight: 900;
            color: var(--neon-green);
            text-shadow: 
                0 0 20px rgba(0, 255, 136, 0.8),
                0 0 40px rgba(0, 255, 136, 0.4);
            letter-spacing: 0.1em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
        }

        .display-total.pulse {
            animation: totalPulse 0.6s ease-out;
        }

        @keyframes totalPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .input-section {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-label {
            font-size: 1.1rem;
            color: var(--text-dim);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .input-group {
            display: flex;
            gap: 10px;
            align-items: stretch;
        }

        .input-field {
            flex: 1;
            background: rgba(15, 20, 30, 1) !important;
            border: 2px solid var(--accent-blue);
            border-radius: 16px;
            padding: 20px;
            font-size: 2rem;
            font-family: 'Orbitron', monospace;
            color: #ffffff !important;
            text-align: center;
            font-weight: 700;
            transition: all 0.3s;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
            -webkit-text-fill-color: #ffffff !important;
        }

        .input-field:focus {
            outline: none;
            border-color: var(--neon-green) !important;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            background: rgba(10, 15, 25, 1) !important;
            color: var(--neon-green) !important;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
            -webkit-text-fill-color: var(--neon-green) !important;
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.3) !important;
            text-shadow: none;
            -webkit-text-fill-color: rgba(255, 255, 255, 0.3) !important;
        }

        /* Forzar estilo en Chrome/Safari */
        input[type="number"].input-field {
            color: #ffffff !important;
            -webkit-text-fill-color: #ffffff !important;
        }

        input[type="number"].input-field:focus {
            color: var(--neon-green) !important;
            -webkit-text-fill-color: var(--neon-green) !important;
        }

        .btn-add {
            background: linear-gradient(135deg, var(--neon-green) 0%, var(--accent-blue) 100%);
            border: none;
            border-radius: 16px;
            padding: 20px 40px;
            font-size: 2rem;
            font-weight: 900;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(0, 255, 136, 0.3);
            font-family: 'Rajdhani', sans-serif;
            min-width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-add:active {
            transform: scale(0.95);
            box-shadow: 0 4px 10px rgba(0, 255, 136, 0.5);
        }

        .items-list {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 200px;
            overflow-y: auto;
        }

        .items-header {
            font-size: 1rem;
            color: var(--text-dim);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(0, 212, 255, 0.05);
            border-radius: 12px;
            margin-bottom: 10px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .item-price {
            font-family: 'Orbitron', monospace;
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--neon-green);
        }

        .btn-remove {
            background: var(--warning-red);
            border: none;
            border-radius: 8px;
            width: 35px;
            height: 35px;
            font-size: 1.2rem;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-remove:active {
            transform: scale(0.9);
        }

        .empty-items {
            text-align: center;
            color: var(--text-dim);
            padding: 30px;
            font-size: 1.1rem;
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn-cobrar {
            background: linear-gradient(135deg, var(--success-gold) 0%, #ffaa00 100%);
            border: none;
            border-radius: 20px;
            padding: 25px;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-bg);
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 30px rgba(255, 199, 0, 0.4);
            font-family: 'Rajdhani', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-cobrar::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent 30%,
                rgba(255, 255, 255, 0.3) 50%,
                transparent 70%
            );
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .btn-cobrar:active {
            transform: scale(0.95);
        }

        .btn-cobrar:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn-cancel {
            background: transparent;
            border: 2px solid var(--warning-red);
            border-radius: 16px;
            padding: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--warning-red);
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Rajdhani', sans-serif;
        }

        .btn-cancel:active {
            background: rgba(255, 51, 102, 0.1);
        }

        /* ============================================
           MODAL: M√âTODO DE PAGO
        ============================================ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 14, 26, 0.95);
            backdrop-filter: blur(10px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: linear-gradient(135deg, var(--card-bg) 0%, #1f2437 100%);
            border: 2px solid var(--accent-blue);
            border-radius: 24px;
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--success-gold);
            margin-bottom: 15px;
        }

        .modal-amount {
            font-family: 'Orbitron', monospace;
            font-size: 3rem;
            font-weight: 900;
            color: var(--neon-green);
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.6);
            animation: modalAmountPulse 1s ease-in-out infinite;
        }

        @keyframes modalAmountPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .modal-question {
            text-align: center;
            font-size: 1.2rem;
            color: var(--text-dim);
            margin: 20px 0;
            font-weight: 600;
        }

        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .btn-payment {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2) 0%, rgba(184, 79, 255, 0.2) 100%);
            border: 2px solid var(--accent-blue);
            border-radius: 16px;
            padding: 20px;
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Rajdhani', sans-serif;
            text-align: left;
        }

        .btn-payment:active {
            transform: scale(0.95);
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.4) 0%, rgba(184, 79, 255, 0.4) 100%);
            border-color: var(--neon-green);
        }

        .btn-modal-back {
            background: transparent;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 12px;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dim);
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            font-family: 'Rajdhani', sans-serif;
        }

        .btn-modal-back:active {
            background: rgba(255, 255, 255, 0.1);
        }

        /* ============================================
           PANTALLA: REGISTRAR GASTO
        ============================================ */
        /* ============================================
           SELECT PERSONALIZADO
        ============================================ */
        .custom-select-wrapper {
            position: relative;
            width: 100%;
        }

        .custom-select {
            position: relative;
            width: 100%;
        }

        .custom-select-trigger {
            background: rgba(31, 36, 55, 0.8);
            border: 2px solid var(--accent-purple);
            border-radius: 16px;
            padding: 20px;
            font-size: 1.2rem;
            font-family: 'Rajdhani', sans-serif;
            color: rgba(255, 255, 255, 0.5);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .custom-select-trigger:hover {
            border-color: var(--neon-green);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.2);
        }

        .custom-select-trigger.selected {
            color: var(--neon-green) !important;
            border-color: var(--neon-green);
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .custom-arrow {
            color: var(--accent-purple);
            transition: transform 0.3s;
            font-size: 1rem;
        }

        .custom-select.open .custom-arrow {
            transform: rotate(180deg);
            color: var(--neon-green);
        }

        .custom-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card-bg);
            border: 2px solid var(--accent-purple);
            border-radius: 16px;
            margin-top: 8px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            z-index: 100;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .custom-select.open .custom-options {
            max-height: 300px;
            overflow-y: auto;
            border-color: var(--neon-green);
        }

        .custom-option {
            padding: 18px 20px;
            font-size: 1.2rem;
            font-family: 'Rajdhani', sans-serif;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .custom-option:last-child {
            border-bottom: none;
        }

        .custom-option:hover {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.2), rgba(184, 79, 255, 0.2));
            color: var(--neon-green);
            padding-left: 30px;
        }

        .custom-option:active {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.4), rgba(184, 79, 255, 0.4));
        }

        /* ============================================
           FIN SELECT PERSONALIZADO
        ============================================ */

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            font-size: 1.1rem;
            color: var(--text-dim);
            margin-bottom: 10px;
            display: block;
            font-weight: 600;
        }

        .form-input {
            width: 100%;
            background: rgba(15, 20, 30, 1) !important;
            border: 2px solid var(--accent-purple);
            border-radius: 16px;
            padding: 20px;
            font-size: 1.8rem;
            font-family: 'Orbitron', monospace;
            color: #ffffff !important;
            font-weight: 700;
            transition: all 0.3s;
            text-align: center;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
            -webkit-text-fill-color: #ffffff !important;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--neon-green) !important;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            background: rgba(10, 15, 25, 1) !important;
            color: var(--neon-green) !important;
            text-shadow: 0 0 20px rgba(0, 255, 136, 0.8);
            -webkit-text-fill-color: var(--neon-green) !important;
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.4) !important;
            text-shadow: none;
            -webkit-text-fill-color: rgba(255, 255, 255, 0.4) !important;
        }

        /* Forzar estilo en Chrome/Safari */
        input[type="number"].form-input {
            color: #ffffff !important;
            -webkit-text-fill-color: #ffffff !important;
        }

        input[type="number"].form-input:focus {
            color: var(--neon-green) !important;
            -webkit-text-fill-color: var(--neon-green) !important;
        }

        .form-select {
            width: 100%;
            background: rgba(31, 36, 55, 0.8) !important;
            border: 2px solid var(--accent-purple);
            border-radius: 16px;
            padding: 20px;
            font-size: 1.2rem;
            font-family: 'Rajdhani', sans-serif;
            color: white !important;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23b84fff' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            padding-right: 50px;
        }

        .form-select:focus {
            outline: none;
            border-color: var(--neon-green);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            background: rgba(31, 36, 55, 0.95) !important;
            color: var(--neon-green) !important;
        }

        .form-select option {
            background: var(--card-bg) !important;
            color: white !important;
            padding: 15px;
        }

        .form-select option:disabled {
            color: rgba(255, 255, 255, 0.4) !important;
        }

        .form-select option:checked {
            background: linear-gradient(135deg, var(--accent-purple), var(--warning-red)) !important;
            color: white !important;
            font-weight: 700;
        }

        /* Forzar estilos espec√≠ficos para el select cuando tiene valor */
        .form-select:valid {
            color: var(--neon-green) !important;
            border-color: var(--neon-green);
        }

        /* Mejorar visualizaci√≥n en m√≥vil */
        @media (max-width: 480px) {
            .form-select {
                font-size: 1.1rem;
            }
        }

        .form-textarea {
            width: 100%;
            background: rgba(20, 25, 40, 0.95);
            border: 2px solid var(--accent-purple);
            border-radius: 16px;
            padding: 20px;
            font-size: 1.1rem;
            font-family: 'Rajdhani', sans-serif;
            color: #ffffff;
            font-weight: 600;
            resize: vertical;
            min-height: 80px;
            transition: all 0.3s;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.2);
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--neon-green);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
            background: rgba(15, 20, 35, 1);
            color: var(--neon-green);
            text-shadow: 0 0 12px rgba(0, 255, 136, 0.5);
        }

        .form-textarea::placeholder {
            color: rgba(255, 255, 255, 0.4);
            text-shadow: none;
        }

        .btn-save {
            background: linear-gradient(135deg, var(--accent-purple) 0%, var(--warning-red) 100%);
            border: none;
            border-radius: 20px;
            padding: 25px;
            font-size: 1.8rem;
            font-weight: 700;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            box-shadow: 0 10px 30px rgba(184, 79, 255, 0.4);
            font-family: 'Rajdhani', sans-serif;
        }

        .btn-save:active {
            transform: scale(0.95);
        }

        /* ============================================
           NOTIFICACIONES
        ============================================ */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: linear-gradient(135deg, var(--neon-green) 0%, var(--accent-blue) 100%);
            color: var(--dark-bg);
            padding: 20px 30px;
            border-radius: 16px;
            font-size: 1.2rem;
            font-weight: 700;
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.5);
            z-index: 2000;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Rajdhani', sans-serif;
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
        }

        .notification.success {
            background: linear-gradient(135deg, var(--neon-green) 0%, var(--success-gold) 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, var(--warning-red) 0%, #ff0066 100%);
            color: white;
        }

        /* ============================================
           CONFETTI (Animaci√≥n de √©xito)
        ============================================ */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: var(--success-gold);
            position: absolute;
            animation: confettiFall 3s linear;
            z-index: 1500;
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* ============================================
           FOOTER
        ============================================ */
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-dim);
            font-size: 0.9rem;
            margin-top: 40px;
        }

        .footer-name {
            font-weight: 700;
            color: var(--accent-blue);
        }

        /* ============================================
           SCROLLBAR PERSONALIZADO
        ============================================ */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-blue);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--neon-green);
        }

        /* ============================================
           RESPONSIVE
        ============================================ */
        @media (max-width: 400px) {
            .display-total {
                font-size: 3rem;
            }
            
            .modal-amount {
                font-size: 2.5rem;
            }
            
            .input-field {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ============================================
             PANTALLA 1: MEN√ö PRINCIPAL
        ============================================ -->
        <div id="menu-screen" class="screen active">
            <div class="header">
                <div class="user-info">
                    <div class="user-name">üë§ <span id="userName">Cargando...</span></div>
                    <div class="user-id">ID: <span id="userId">---</span></div>
                </div>
            </div>

            <div class="main-buttons">
                <button class="btn-main ventas" onclick="showVentasScreen()">
                    <span class="btn-icon">üõí</span>
                    NUEVA VENTA
                </button>

                <button class="btn-main gastos" onclick="showGastosScreen()">
                    <span class="btn-icon">üí∏</span>
                    REGISTRAR GASTO
                </button>
            </div>

            <div class="footer">
                <div>Powered by <span class="footer-name">Arnaldo Ayala</span></div>
                <div>Estratega en IA y Marketing</div>
            </div>
        </div>

        <!-- ============================================
             PANTALLA 2: NUEVA VENTA
        ============================================ -->
        <div id="ventas-screen" class="screen">
            <div class="top-bar">
                <button class="btn-back" onclick="showMenuScreen()">‚Üê Men√∫</button>
            </div>

            <div class="display-container">
                <div class="display-label">üè™ ALMAC√âN</div>
                <div class="display-total-label">TOTAL</div>
                <div class="display-total" id="totalDisplay">$ 0.00</div>
            </div>

            <div class="input-section">
                <div class="input-label">Agregar producto:</div>
                <div class="input-group">
                    <input 
                        type="number" 
                        class="input-field" 
                        id="montoInput" 
                        placeholder="0"
                        step="0.01"
                        min="0"
                    >
                    <button class="btn-add" onclick="agregarItem()">
                        <span style="font-size: 2.5rem;">+</span>
                    </button>
                </div>
            </div>

            <div class="items-list">
                <div class="items-header">Items: <span id="itemsCount">0</span></div>
                <div id="itemsList">
                    <div class="empty-items">No hay items agregados</div>
                </div>
            </div>

            <div class="actions">
                <button class="btn-cobrar" id="btnCobrar" onclick="mostrarModalCobro()" disabled>
                    üí∞ CERRAR VENTA - <span id="totalCobrar">$ 0.00</span>
                </button>
                <button class="btn-cancel" onclick="cancelarVenta()">
                    üóëÔ∏è CANCELAR VENTA
                </button>
            </div>
        </div>

        <!-- ============================================
             PANTALLA 3: REGISTRAR GASTO
        ============================================ -->
        <div id="gastos-screen" class="screen">
            <div class="top-bar">
                <button class="btn-back" onclick="showMenuScreen()">‚Üê Men√∫</button>
            </div>

            <div class="input-section">
                <h2 style="text-align: center; margin-bottom: 30px; font-size: 1.8rem; color: var(--accent-purple);">
                    üí∏ REGISTRAR GASTO
                </h2>

                <div class="form-group">
                    <label class="form-label">Monto:</label>
                    <input 
                        type="number" 
                        class="form-input" 
                        id="montoGasto" 
                        placeholder="0.00"
                        step="0.01"
                        min="0"
                    >
                </div>

                <div class="form-group">
                    <label class="form-label">Categor√≠a:</label>
                    
                    <!-- Select personalizado -->
                    <div class="custom-select-wrapper">
                        <div class="custom-select" id="customSelect">
                            <div class="custom-select-trigger" id="selectTrigger">
                                <span id="selectedText">Seleccionar categor√≠a...</span>
                                <span class="custom-arrow">‚ñº</span>
                            </div>
                            <div class="custom-options" id="customOptions">
                                <div class="custom-option" data-value="Proveedores">Proveedores</div>
                                <div class="custom-option" data-value="Servicios">Servicios</div>
                                <div class="custom-option" data-value="Alquiler">Alquiler</div>
                                <div class="custom-option" data-value="Sueldos">Sueldos</div>
                                <div class="custom-option" data-value="Otros">Otros</div>
                            </div>
                        </div>
                        <!-- Input hidden para guardar el valor -->
                        <input type="hidden" id="categoriaGasto" name="categoriaGasto" value="">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Descripci√≥n (opcional):</label>
                    <textarea 
                        class="form-textarea" 
                        id="descripcionGasto" 
                        placeholder="Ej: Compra de mercader√≠a..."
                    ></textarea>
                </div>

                <button class="btn-save" onclick="guardarGasto()">
                    üíæ GUARDAR GASTO
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================
         MODAL: M√âTODO DE PAGO
    ============================================ -->
    <div id="modalCobro" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">üí∞ CERRAR VENTA</div>
                <div class="modal-amount" id="modalAmount">$ 0.00</div>
            </div>

            <div class="modal-question">¬øM√©todo de pago?</div>

            <div class="payment-methods">
                <button class="btn-payment" onclick="procesarCobro('Efectivo')">
                    üíµ EFECTIVO
                </button>
                <button class="btn-payment" onclick="procesarCobro('Tarjeta')">
                    üí≥ TARJETA
                </button>
                <button class="btn-payment" onclick="procesarCobro('Transferencia')">
                    üì± TRANSFERENCIA
                </button>
                <button class="btn-payment" onclick="procesarCobro('Fiado')">
                    üìù FIADO
                </button>
            </div>

            <button class="btn-modal-back" onclick="cerrarModalCobro()">
                ‚Üê VOLVER
            </button>
        </div>
    </div>

    <!-- ============================================
         NOTIFICACI√ìN
    ============================================ -->
    <div id="notification" class="notification"></div>

    <!-- ============================================
         JAVASCRIPT
    ============================================ -->
    <script>
        // ============================================
        // VARIABLES GLOBALES
        // ============================================
        let comercianteData = {
            id: '',
            nombre: '',
            email: ''
        };

        let ventaActual = {
            items: [],
            total: 0
        };

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        window.addEventListener('DOMContentLoaded', async () => {
            // Obtener ID del comerciante de la URL
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');

            if (!id) {
                mostrarNotificacion('‚ùå Error: No se especific√≥ ID de comerciante', 'error');
                return;
            }

            // Cargar datos del comerciante
            await cargarComercianteData(id);

            // Cargar venta guardada (si existe)
            cargarVentaGuardada();
        });

        // ============================================
        // CARGAR DATOS DEL COMERCIANTE
        // ============================================
        async function cargarComercianteData(id) {
            try {
                // TODO: Reemplazar con tu URL real del webhook de n8n
                const apiUrl = `https://tu-n8n-url.com/webhook/obtener-comerciante?id=${id}`;
                
                // TEMPORAL: Usar datos de prueba
                comercianteData = {
                    id: id,
                    nombre: 'Arnaldo Ayala',
                    email: 'arnaldo@ejemplo.com'
                };

                // Actualizar UI
                document.getElementById('userName').textContent = comercianteData.nombre;
                document.getElementById('userId').textContent = comercianteData.id;

                /* 
                // Descomentar cuando tengas la API lista:
                const response = await fetch(apiUrl);
                const data = await response.json();
                
                comercianteData = {
                    id: data.id,
                    nombre: data.nombre,
                    email: data.email
                };

                document.getElementById('userName').textContent = comercianteData.nombre;
                document.getElementById('userId').textContent = comercianteData.id;
                */
            } catch (error) {
                console.error('Error al cargar comerciante:', error);
                mostrarNotificacion('‚ùå Error al cargar datos del comerciante', 'error');
            }
        }

        // ============================================
        // NAVEGACI√ìN ENTRE PANTALLAS
        // ============================================
        function showMenuScreen() {
            hideAllScreens();
            document.getElementById('menu-screen').classList.add('active');
        }

        function showVentasScreen() {
            hideAllScreens();
            document.getElementById('ventas-screen').classList.add('active');
            document.getElementById('montoInput').focus();
        }

        function showGastosScreen() {
            hideAllScreens();
            document.getElementById('gastos-screen').classList.add('active');
            document.getElementById('montoGasto').focus();
        }

        function hideAllScreens() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
        }

        // ============================================
        // NUEVA VENTA - AGREGAR ITEMS
        // ============================================
        function agregarItem() {
            const input = document.getElementById('montoInput');
            const monto = parseFloat(input.value);

            if (!monto || monto <= 0) {
                mostrarNotificacion('‚ö†Ô∏è Ingresa un monto v√°lido', 'error');
                return;
            }

            // Agregar item al array
            ventaActual.items.push(monto);
            ventaActual.total += monto;

            // Actualizar UI
            actualizarDisplayTotal();
            actualizarListaItems();
            
            // Guardar en localStorage
            guardarVentaTemporal();

            // Limpiar input y hacer focus
            input.value = '';
            input.focus();

            // Animaci√≥n de pulso en el total
            document.getElementById('totalDisplay').classList.add('pulse');
            setTimeout(() => {
                document.getElementById('totalDisplay').classList.remove('pulse');
            }, 600);
        }

        function actualizarDisplayTotal() {
            const totalFormatted = ventaActual.total.toFixed(2);
            document.getElementById('totalDisplay').textContent = `$ ${totalFormatted}`;
            document.getElementById('totalCobrar').textContent = `$ ${totalFormatted}`;
            
            // Habilitar/deshabilitar bot√≥n de cobrar
            const btnCobrar = document.getElementById('btnCobrar');
            btnCobrar.disabled = ventaActual.items.length === 0;
        }

        function actualizarListaItems() {
            const listContainer = document.getElementById('itemsList');
            const countDisplay = document.getElementById('itemsCount');

            countDisplay.textContent = ventaActual.items.length;

            if (ventaActual.items.length === 0) {
                listContainer.innerHTML = '<div class="empty-items">No hay items agregados</div>';
                return;
            }

            listContainer.innerHTML = ventaActual.items.map((item, index) => `
                <div class="item">
                    <span class="item-price">$ ${item.toFixed(2)}</span>
                    <button class="btn-remove" onclick="eliminarItem(${index})">√ó</button>
                </div>
            `).join('');
        }

        function eliminarItem(index) {
            // Restar del total
            ventaActual.total -= ventaActual.items[index];
            
            // Eliminar del array
            ventaActual.items.splice(index, 1);

            // Actualizar UI
            actualizarDisplayTotal();
            actualizarListaItems();
            
            // Guardar en localStorage
            guardarVentaTemporal();
        }

        function cancelarVenta() {
            if (ventaActual.items.length === 0) {
                showMenuScreen();
                return;
            }

            if (confirm('¬øEst√°s seguro de cancelar esta venta?')) {
                ventaActual = { items: [], total: 0 };
                actualizarDisplayTotal();
                actualizarListaItems();
                limpiarVentaTemporal();
                showMenuScreen();
            }
        }

        // ============================================
        // MODAL DE COBRO
        // ============================================
        function mostrarModalCobro() {
            const modal = document.getElementById('modalCobro');
            const amount = document.getElementById('modalAmount');
            
            amount.textContent = `$ ${ventaActual.total.toFixed(2)}`;
            modal.classList.add('active');
        }

        function cerrarModalCobro() {
            document.getElementById('modalCobro').classList.remove('active');
        }

        async function procesarCobro(metodoPago) {
            cerrarModalCobro();

            // Preparar datos para enviar
            const transaccion = {
                ID_Comerciante: comercianteData.id,
                Tipo_Transaccion: 'INGRESO',
                Monto_Original: ventaActual.total,
                Metodo_Cobro: metodoPago,
                Categoria_Gasto: '',
                Descripcion: 'Venta - Almac√©n'
            };

            try {
                // TODO: Reemplazar con tu URL real del webhook de n8n
                const apiUrl = 'https://tu-n8n-url.com/webhook/guardar-transaccion';
                
                // TEMPORAL: Simular guardado exitoso
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                /* 
                // Descomentar cuando tengas la API lista:
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(transaccion)
                });

                if (!response.ok) {
                    throw new Error('Error al guardar la transacci√≥n');
                }
                */

                // √âxito: Mostrar animaci√≥n de confetti
                crearConfetti();
                mostrarNotificacion(`‚úÖ ¬°Venta registrada! M√©todo: ${metodoPago}`, 'success');

                // Limpiar venta
                ventaActual = { items: [], total: 0 };
                limpiarVentaTemporal();

                // Volver al men√∫ despu√©s de 2 segundos
                setTimeout(() => {
                    showMenuScreen();
                }, 2000);

            } catch (error) {
                console.error('Error al procesar cobro:', error);
                mostrarNotificacion('‚ùå Error al guardar la venta', 'error');
            }
        }

        // ============================================
        // REGISTRAR GASTO
        // ============================================
        async function guardarGasto() {
            const monto = parseFloat(document.getElementById('montoGasto').value);
            const categoria = document.getElementById('categoriaGasto').value;
            const descripcion = document.getElementById('descripcionGasto').value;

            // Validaciones
            if (!monto || monto <= 0) {
                mostrarNotificacion('‚ö†Ô∏è Ingresa un monto v√°lido', 'error');
                return;
            }

            if (!categoria) {
                mostrarNotificacion('‚ö†Ô∏è Selecciona una categor√≠a', 'error');
                return;
            }

            // Preparar datos
            const transaccion = {
                ID_Comerciante: comercianteData.id,
                Tipo_Transaccion: 'GASTO',
                Monto_Original: monto,
                Metodo_Cobro: '',
                Categoria_Gasto: categoria,
                Descripcion: descripcion || `Gasto - ${categoria}`
            };

            try {
                // TODO: Reemplazar con tu URL real del webhook de n8n
                const apiUrl = 'https://tu-n8n-url.com/webhook/guardar-transaccion';
                
                // TEMPORAL: Simular guardado exitoso
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                /* 
                // Descomentar cuando tengas la API lista:
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(transaccion)
                });

                if (!response.ok) {
                    throw new Error('Error al guardar el gasto');
                }
                */

                // √âxito
                mostrarNotificacion('üíæ Gasto guardado exitosamente', 'success');

                // Limpiar formulario
                document.getElementById('montoGasto').value = '';
                document.getElementById('categoriaGasto').value = '';
                document.getElementById('descripcionGasto').value = '';

                // Volver al men√∫ despu√©s de 1.5 segundos
                setTimeout(() => {
                    showMenuScreen();
                }, 1500);

            } catch (error) {
                console.error('Error al guardar gasto:', error);
                mostrarNotificacion('‚ùå Error al guardar el gasto', 'error');
            }
        }

        // ============================================
        // SELECT PERSONALIZADO
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            const customSelect = document.getElementById('customSelect');
            const selectTrigger = document.getElementById('selectTrigger');
            const customOptions = document.getElementById('customOptions');
            const selectedText = document.getElementById('selectedText');
            const hiddenInput = document.getElementById('categoriaGasto');
            const options = document.querySelectorAll('.custom-option');

            if (selectTrigger && customOptions) {
                // Abrir/cerrar dropdown
                selectTrigger.addEventListener('click', () => {
                    customSelect.classList.toggle('open');
                    
                    // Cerrar otros selects si hubiera
                    document.querySelectorAll('.custom-select').forEach(select => {
                        if (select !== customSelect) {
                            select.classList.remove('open');
                        }
                    });
                });

                // Seleccionar opci√≥n
                options.forEach(option => {
                    option.addEventListener('click', (e) => {
                        const value = e.target.getAttribute('data-value');
                        
                        // Actualizar texto visible
                        selectedText.textContent = value;
                        selectedText.style.color = 'var(--neon-green)';
                        
                        // Actualizar input hidden
                        hiddenInput.value = value;
                        
                        // Marcar como seleccionado
                        selectTrigger.classList.add('selected');
                        
                        // Cerrar dropdown
                        customSelect.classList.remove('open');
                    });
                });

                // Cerrar al hacer click fuera
                document.addEventListener('click', (e) => {
                    if (!customSelect.contains(e.target)) {
                        customSelect.classList.remove('open');
                    }
                });
            }
        });

        // ============================================
        // FEEDBACK VISUAL PARA SELECT (Ya no necesario pero lo dejamos por compatibilidad)
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            const selectCategoria = document.getElementById('categoriaGasto');
            
            if (selectCategoria) {
                // Aplicar estilos cuando cambia
                selectCategoria.addEventListener('change', function() {
                    if (this.value && this.value !== '') {
                        this.style.borderColor = 'var(--neon-green)';
                        this.style.color = 'var(--neon-green)';
                        this.style.fontWeight = '700';
                        this.style.textShadow = '0 0 10px rgba(0, 255, 136, 0.5)';
                    } else {
                        this.style.borderColor = 'var(--accent-purple)';
                        this.style.color = 'white';
                        this.style.fontWeight = '600';
                        this.style.textShadow = 'none';
                    }
                });

                // Verificar si ya tiene valor al cargar
                if (selectCategoria.value && selectCategoria.value !== '') {
                    selectCategoria.style.borderColor = 'var(--neon-green)';
                    selectCategoria.style.color = 'var(--neon-green)';
                    selectCategoria.style.fontWeight = '700';
                }
            }
        });

        // ============================================
        // PERSISTENCIA LOCAL (localStorage)
        // ============================================
        function guardarVentaTemporal() {
            localStorage.setItem(`venta_${comercianteData.id}`, JSON.stringify(ventaActual));
        }

        function cargarVentaGuardada() {
            const saved = localStorage.getItem(`venta_${comercianteData.id}`);
            if (saved) {
                ventaActual = JSON.parse(saved);
                actualizarDisplayTotal();
                actualizarListaItems();
            }
        }

        function limpiarVentaTemporal() {
            localStorage.removeItem(`venta_${comercianteData.id}`);
        }

        // ============================================
        // NOTIFICACIONES
        // ============================================
        function mostrarNotificacion(mensaje, tipo = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = mensaje;
            notification.className = `notification ${tipo}`;
            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ============================================
        // ANIMACI√ìN CONFETTI
        // ============================================
        function crearConfetti() {
            const colors = ['#00ff88', '#00d4ff', '#b84fff', '#ffc700', '#ff3366'];
            const confettiCount = 50;

            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = Math.random() * 0.5 + 's';
                    document.body.appendChild(confetti);

                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 30);
            }
        }

        // ============================================
        // EVENTOS DE TECLADO
        // ============================================
        document.addEventListener('keypress', (e) => {
            // Enter en el input de venta ‚Üí agregar item
            if (e.key === 'Enter' && document.activeElement.id === 'montoInput') {
                agregarItem();
            }
            
            // Enter en el input de gasto ‚Üí guardar
            if (e.key === 'Enter' && document.activeElement.id === 'montoGasto') {
                guardarGasto();
            }
        });
    </script>
</body>
</html>
